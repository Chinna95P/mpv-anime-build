###########
# General #
###########

# --- UNIVERSAL OS DETECTION ---

[platform-windows]
profile-cond=platform == "windows"
profile-desc=Windows Backend
input-ipc-server=\\.\pipe\mpvpipe
vo=gpu-next
gpu-api=d3d11
gpu-context=d3d11
# SVP REQUIREMENT: Must use copy-back so SVP can read frames
hwdec=auto-copy
d3d11-flip=yes
d3d11-exclusive-fs=no

[platform-unix]
profile-cond=platform ~= "windows"
profile-desc=Linux Backend
input-ipc-server=/tmp/mpvsocket
vo=gpu-next
gpu-api=vulkan
gpu-context=waylandvk
hwdec=auto-copy

# --- DEFAULT SETTINGS (Global) ---
[default]

hwdec=auto-copy                         
hwdec-codecs=all
demuxer-thread=yes
save-position-on-quit=yes
save-watch-history=yes
fullscreen=yes
no-border
autofit-larger=100%x95%
osc=no
input-cursor=yes
msg-level=ffmpeg/video=fatal

# Windows Desktop Paths
screenshot-template='~~desktop/%F (%P) %n'
watch-later-directory='~~/watch_later'

########################################
# CACHE & PERFORMANCE
########################################

cache=yes
cache-pause=no
demuxer-max-bytes=1024MiB
demuxer-max-back-bytes=256MiB
vd-lavc-threads=8
ad-lavc-threads=4

#########
# Audio #
#########
audio-channels=7.1,5.1,stereo
af=lavfi=[surround=chl_out=7.1:lfe_low=80]

[Bitstream-Audio]
audio-spdif=truehd,dtshd,ac3,dts,eac3
af=""

#############
# Subtitles #
#############
demuxer-mkv-subtitle-preroll=yes
demuxer-mkv-subtitle-preroll-secs=2
sub-auto=fuzzy
sub-file-paths-append=ass:srt:sub:subs:subtitles
embeddedfonts=yes
sub-fix-timing=no
sub-use-margins=yes
sub-ass-force-margins=yes
sub-ass-override=yes           
blend-subtitles=no
sub-scale-with-window=yes
sub-font="Source Sans Pro Semibold"
sub-font-size=36
sub-color="#FFFFFFFF"
sub-border-color="#FF262626"
sub-border-size=3.2
sub-shadow-offset=1
sub-shadow-color="#33000000"
sub-spacing=0.5
sub-pos=100

#############
# Languages #
#############
slang=enm,en,eng
alang=jpn,ja,jp,en,eng

################
# Video Output #
################
# Handled by platform profiles, but defaults are safe
hr-seek-framedrop=no
dither-depth=auto
dither=fruit

########################################
# COLOR TUNING (DESKTOP SDR)
########################################
gamma=1.02
contrast=1.05
saturation=1.05
brightness=0.0

# --- Frame Timing ---
video-sync=audio
interpolation=no
icc-profile-auto

# --- Static Profiles ---

[High-Quality]
profile-desc=Live Action / Non-Anime (TV-like Upscaling)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
correct-downscaling=yes
deband=yes
deband-iterations=1
deband-threshold=24
deband-range=12
deband-grain=16
glsl-shaders-clr
glsl-shaders-append="~~/shaders/FSRCNNX_x2_16-0-4-1.glsl"
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-1080p.glsl"

[HQ-SD-Clean]
profile-desc=Non-Anime <576p (Clean SD)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
correct-downscaling=yes
deband=yes
deband-iterations=1
deband-threshold=26
deband-range=16
deband-grain=20
vf=hqdn3d=0:0:4:4
glsl-shaders-clr
glsl-shaders-append="~~/shaders/nnedi3-nns256-win8x4.hook"
glsl-shaders-append="~~/shaders/SSimSuperRes.glsl"
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-SD.glsl"

[HQ-SD-Texture]
profile-desc=Non-Anime <576p (Texture Masked SD)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
correct-downscaling=yes
deband=yes
deband-iterations=1
deband-threshold=22
deband-range=14
deband-grain=40
glsl-shaders-clr
glsl-shaders-append="~~/shaders/nnedi3-nns256-win8x4.hook"
glsl-shaders-append="~~/shaders/SSimSuperRes.glsl"

[HQ-SD-FSRCNNX]
profile-desc=Non-Anime <576p (FSRCNNX Sharp)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
correct-downscaling=yes
deband=yes
deband-iterations=1
deband-threshold=24
deband-range=12
deband-grain=16
glsl-shaders-clr
glsl-shaders-append="~~/shaders/FSRCNNX_x2_16-0-4-1.glsl"
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-SD.glsl"

[HQ-HD-NNEDI]
profile-desc=Non-Anime 576pâ€“<1080p (NNEDI Geometry Focus)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
correct-downscaling=yes
deband=yes
deband-iterations=1
deband-threshold=24
deband-range=12
deband-grain=16
glsl-shaders-clr
glsl-shaders-append="~~/shaders/nnedi3-nns64-win8x4.hook"
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-HD.glsl"

[Mid-Quality]
profile-desc=Optimized for 4K/HFR
scale=spline36
cscale=spline36
dscale=mitchell
deband=yes
glsl-shaders-clr
glsl-shaders-append="~~/shaders/FSRCNNX_x2_8-0-4-1.glsl"
glsl-shaders-append="~~/shaders/KrigBilateral.glsl"
glsl-shaders-append="~~/shaders/SSimSuperRes.glsl"
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-1080p.glsl"

[Low-Quality]
profile-desc=Performance Fallback
scale=bilinear
cscale=bilinear
deband=no
glsl-shaders-clr
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-1080p.glsl"

[HDR-High-Quality]
profile-cond=p["video-params/sig-peak"] > 1
msg-level=ffmpeg/video=fatal
target-colorspace-hint=no
target-trc=srgb
tone-mapping=spline
gamut-mapping-mode=auto
hdr-compute-peak=yes
hdr-peak-percentile=99.8
hdr-contrast-recovery=0.30
hdr-peak-decay-rate=100.0
tone-mapping-visualize=no

[anime-shaders]
profile-desc=Anime only (line art + clean gradients)
scale=ewa_lanczossharp
cscale=spline36
dscale=mitchell
deband=yes
deband-iterations=2
deband-threshold=28
deband-range=14
deband-grain=4

[Nvidia-VSR]
profile-desc=Switches backend to D3D11 for VSR (Windows Only)
vo=gpu-next
gpu-api=d3d11
gpu-context=d3d11
# Attempt to keep auto-copy for SVP. 
# If VSR breaks, change this to 'd3d11va' (but that will disable SVP)
hwdec=auto-copy
glsl-shaders=""

[4K-Native]
profile-desc=4K Content (No Upscaling)
deband=no
glsl-shaders-clr
# We only use the sharpener. No FSRCNNX or NNEDI3 needed.
glsl-shaders-append="~~/shaders/adaptive-sharpen-modern-1080p.glsl"